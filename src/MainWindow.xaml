<mah:MetroWindow x:Class="PakMaster.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        xmlns:mah="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PakMaster"
        xmlns:viewmodels="clr-namespace:PakMaster.Resources.ViewModels" 
        d:DataContext="{d:DesignInstance Type=viewmodels:MainWindowViewModel}"
        Title="PakMaster"
        Width="1366"
        Height="768"
        FontFamily="Segoe UI"
        GlowBrush="{DynamicResource MahApps.Brushes.Accent}"
        ResizeMode="CanMinimize"
        WindowStartupLocation="CenterScreen"
        mc:Ignorable="d">

    <mah:MetroWindow.LeftWindowCommands>
        <mah:WindowCommands>
            <Button Click="LaunchBrowserGitHubPakMaster" ToolTip="Open up the PakMaster GitHub repo">
                <iconPacks:PackIconMaterial Width="22" Height="22" Kind="Github" />
            </Button>
        </mah:WindowCommands>
    </mah:MetroWindow.LeftWindowCommands>

    <mah:MetroWindow.RightWindowCommands>
        <mah:WindowCommands>
            <Button Click="CheckForUpdatesPakMasterAsync" Content="Check for updates">
                <Button.ContentTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconMaterial Width="22" Height="22" VerticalAlignment="Center" Kind="Update" />
                            <TextBlock Margin="4 0 0 0" VerticalAlignment="Center" Text="{Binding}" />
                        </StackPanel>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>
            <!--
            <Button Click="OpenSettingsFlyout" Content="Settings">
                <Button.ContentTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconMaterial Width="22" Height="22" VerticalAlignment="Center" Kind="Cog" />
                            <TextBlock Margin="4 0 0 0" VerticalAlignment="Center" Text="{Binding}" />
                        </StackPanel>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>
            -->
        </mah:WindowCommands>
    </mah:MetroWindow.RightWindowCommands>
    
    <!-- Resources -->
    <mah:MetroWindow.Resources>
        <Style x:Key="CenteredCellStyle" TargetType="TextBlock">
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>
    </mah:MetroWindow.Resources>

    <Grid>
        <mah:SplitView x:Name="SplitView" DisplayMode="CompactOverlay" IsPaneOpen="False" CompactPaneLength="50" OpenPaneLength="250" PaneBackground="#1C1C1C">
            <mah:SplitView.Pane>
                <!-- Sidebar Navigation -->
                <mah:HamburgerMenu Grid.Column="0" HorizontalAlignment="Left" VerticalAlignment="Stretch"
                                   IsPaneOpen="{Binding IsPaneOpen, ElementName=SplitView, Mode=TwoWay}" CompactPaneLength="50" OpenPaneLength="250" 
                                   PaneBackground="#1C1C1C" Foreground="White"
                                   HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" 
                                   Background="Transparent" Width="250">

                    <mah:HamburgerMenu.ItemTemplate>
                        <DataTemplate>
                            <Button Command="{Binding Command}" 
                                    HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                    HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch"
                                    Background="Transparent" BorderThickness="0">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="{TemplateBinding Background}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>

                                            <!-- MenuItem Icon -->
                                            <iconPacks:PackIconMaterial Width="25" Height="25" 
                                                                        Kind="{Binding Icon}" 
                                                                        VerticalAlignment="Center" HorizontalAlignment="Center" 
                                                                        Margin="12,10,10,10" Grid.Column="0" />

                                            <!-- MenuItem Text -->
                                            <TextBlock Text="{Binding Text}" FontSize="16" FontWeight="Bold" 
                                                       VerticalAlignment="Center" HorizontalAlignment="Left" 
                                                       Margin="5,10,10,10" Grid.Column="1" />
                                        </Grid>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </DataTemplate>
                    </mah:HamburgerMenu.ItemTemplate>

                    <mah:HamburgerMenu.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            <Setter Property="VerticalContentAlignment" Value="Center" />
                            <Setter Property="Padding" Value="5" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Grid x:Name="RootGrid" Background="{TemplateBinding Background}">
                                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                                        </Grid>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="RootGrid" Property="Background" Value="{DynamicResource MahApps.Brushes.Accent}" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </mah:HamburgerMenu.ItemContainerStyle>

                    <mah:HamburgerMenu.ItemsSource>
                        <Binding Path="MenuItems" />
                    </mah:HamburgerMenu.ItemsSource>
                </mah:HamburgerMenu>
            </mah:SplitView.Pane>

            <mah:SplitView.Content>
                <!-- Main Content -->
                <Grid Background="#1F1F1F">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="500" />
                        <ColumnDefinition Width="1*" />
                    </Grid.ColumnDefinitions>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Input Section -->
                    <StackPanel Grid.Column="0" Background="#222222" Margin="10">
                        <TextBlock Text="Files" Foreground="White" FontWeight="Bold" FontSize="24" HorizontalAlignment="Center" />
                        <!-- ListBox to display files -->
                        <ListBox Name="InputFilesListBox" DisplayMemberPath="Key" SelectionMode="Single" Background="Transparent" Margin="5" Height="490" />
                        <Grid HorizontalAlignment="Stretch">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Button Content="Browse input folder" Background="#262626" Height="30" FontSize="12" FontWeight="Bold" Click="BrowseInputFolder" Grid.Column="0" />

                            <Button Background="#262626" Height="30" Width="30" FontSize="12" FontWeight="Bold" Click="btnRefreshUI_Click" Grid.Column="1">
                                <Button.Content>
                                    <iconPacks:PackIconMaterial Kind="Refresh" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                </Button.Content>
                            </Button>
                        </Grid>
                    </StackPanel>

                    <!-- Center Column -->
                    <Grid Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="175" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="175" />
                        </Grid.RowDefinitions>

                        <!-- Repak/ZenTools Toggle -->
                        <StackPanel Grid.Row="0" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="5">

                            <Grid HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="200" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!-- Toggle Button for Mode Switching -->
                                <ToggleButton x:Name="ModeSwitchButton" 
                                              Width="200" Height="40" 
                                              FontSize="16" FontWeight="Bold"
                                              VerticalAlignment="Center" HorizontalAlignment="Center" 
                                              HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                              Grid.Column="1"
                                              Checked="btnModeSwitchIoStore_Click"
                                              Unchecked="btnModeSwitchNormal_Click">
                                    Normal Mode
                                    <ToggleButton.Style>
                                        <Style TargetType="ToggleButton" BasedOn="{StaticResource {x:Type ToggleButton}}">
                                            <Setter Property="Background" Value="#262626" />
                                            <Setter Property="Foreground" Value="White" />
                                            <Style.Triggers>
                                                <Trigger Property="IsChecked" Value="True">
                                                    <Setter Property="Background" Value="{DynamicResource MahApps.Brushes.Accent}" />
                                                    <Setter Property="Foreground" Value="White" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ToggleButton.Style>
                                </ToggleButton>
                            </Grid>
                        </StackPanel>

                        <!-- Pack/Unpack Buttons Section -->
                        <StackPanel Grid.Row="1" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5">
                            <Button Margin="5" Width="150" Height="40" Background="#262626" Click="btnUnpack_ClickAsync">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="25" />
                                        <ColumnDefinition Width="75" />
                                        <ColumnDefinition Width="25" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="1" Text="Unpack" FontSize="14" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" />
                                    <TextBlock Grid.Column="2" Text=">>>" FontSize="12" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" />
                                </Grid>
                            </Button>
                            <Button Margin="5" Width="150" Height="40" Background="#262626" Click="btnRepack_ClickAsync">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="25" />
                                        <ColumnDefinition Width="75" />
                                        <ColumnDefinition Width="25" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="&lt;&lt;&lt;" FontSize="12" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Left" />
                                    <TextBlock Grid.Column="1" Text="Repack" FontSize="14" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" />
                                </Grid>
                            </Button>
                        </StackPanel>
                    </Grid>

                    <!-- Output Section -->
                    <StackPanel Grid.Column="2" Background="#222222" Margin="10">
                        <TextBlock Text="Folders" Foreground="White" FontWeight="Bold" FontSize="24" HorizontalAlignment="Center" />
                        <!-- ListBox to display output files -->
                        <ListBox Name="OutputFilesListBox" DisplayMemberPath="Key" SelectionMode="Single" Background="Transparent" Margin="5" Height="490" />
                        <Grid HorizontalAlignment="Stretch">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Button Content="Browse output folder" Background="#262626" Height="30" FontSize="12" FontWeight="Bold" Click="BrowseOutputFolder" Grid.Column="0" />

                            <Button Background="#262626" Height="30" Width="30" FontSize="12" FontWeight="Bold" Click="btnRefreshUI_Click" Grid.Column="1">
                                <Button.Content>
                                    <iconPacks:PackIconMaterial Kind="Refresh" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                </Button.Content>
                            </Button>
                        </Grid>
                    </StackPanel>

                    <!-- Command Line Output -->
                    <StackPanel Grid.Row="2" Grid.ColumnSpan="3" Background="#262626" Margin="10" Height="125">
                        <!-- TextBox to display CLI output -->
                        <TextBox x:Name="CommandOutputTextBox" 
                                 Background="#202020" 
                                 Foreground="White" 
                                 FontSize="12" 
                                 IsReadOnly="True" 
                                 VerticalScrollBarVisibility="Auto" 
                                 Height="125" 
                                 BorderBrush="#7F7F7F" 
                                 BorderThickness="1"
                                 FocusVisualStyle="{x:Null}">
                            <TextBox.Template>
                                <ControlTemplate TargetType="TextBox">
                                    <Border BorderBrush="{TemplateBinding BorderBrush}" 
                                            BorderThickness="{TemplateBinding BorderThickness}" 
                                            Background="{TemplateBinding Background}">
                                        <ScrollViewer x:Name="PART_ContentHost" VerticalScrollBarVisibility="Auto" />
                                    </Border>
                                </ControlTemplate>
                            </TextBox.Template>
                        </TextBox>
                    </StackPanel>
                </Grid>
            </mah:SplitView.Content>
        </mah:SplitView>
    </Grid>

    <!-- Flyouts Section -->
    <mah:MetroWindow.Flyouts>
        <mah:FlyoutsControl>
            <!-- IoStore Flyout -->
            <mah:Flyout x:Name="IoStoreFlyout" 
                        Header="IoStore Packing" 
                        Position="Left"
                        Width="1271"
                        Background="#1F1F1F"
                        BorderBrush="{DynamicResource MahApps.Brushes.Accent}"
                        BorderThickness="1"
                        IsOpen="{Binding IsIoStoreFlyoutOpen}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="600" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Left Column -->
                    <StackPanel Grid.Column="0" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="5">
                        <!-- UnrealPak Path -->
                        <StackPanel Margin="0,0,0,15">
                            <TextBlock Text="UnrealPak Path (requires Unreal Engine 4.25+)" Foreground="White" FontSize="16" FontWeight="Bold" FontFamily="Segoe UI" HorizontalAlignment="Center" Margin="5"/>
                            <Grid Margin="5">
                                <TextBox Name="UnrealPakPathTextBox" IsReadOnly="True" Background="Transparent" Width="500" VerticalContentAlignment="Center" mah:TextBoxHelper.Watermark="C:\Program Files\Epic Games\UE_5.1\Engine\Binaries\Win64\UnrealPak.exe" />
                                <Button Content="Browse" Background="#262626" Width="75" VerticalAlignment="Center" HorizontalAlignment="Right" Click="BrowseUnrealPakPath" />
                            </Grid>
                        </StackPanel>

                        <!-- Output Path -->
                        <StackPanel Margin="0,15,0,15">
                            <TextBlock Text="Output Path (for global.utoc)" Foreground="White" FontSize="16" FontWeight="Bold" FontFamily="Segoe UI" HorizontalAlignment="Center" Margin="5"/>
                            <Grid Margin="5">
                                <TextBox Name="GlobalOutputPathTextBox" IsReadOnly="True" Background="Transparent" Width="500" VerticalContentAlignment="Center" mah:TextBoxHelper.Watermark="C:\Path\To\Output" />
                                <Button Content="Browse" Background="#262626" Width="75" VerticalAlignment="Center" HorizontalAlignment="Right" Click="BrowseGlobalOutputPath" />
                            </Grid>
                        </StackPanel>

                        <!-- Input Path -->
                        <StackPanel Margin="0,15,0,15">
                            <TextBlock Text="Cooked Files Path (cooked files to be packaged)" Foreground="White" FontSize="16" FontWeight="Bold" FontFamily="Segoe UI" HorizontalAlignment="Center" Margin="5"/>
                            <Grid Margin="5">
                                <TextBox Name="CookedFilesPathTextBox" IsReadOnly="True" Background="Transparent" Width="500" VerticalContentAlignment="Center" mah:TextBoxHelper.Watermark="C:\Path\To\Cooked" />
                                <Button Content="Browse" Background="#262626" Width="75" VerticalAlignment="Center" HorizontalAlignment="Right" Click="BrowseCookedFilesPath" />
                            </Grid>
                        </StackPanel>

                        <!-- Packagestore.manifest Path -->
                        <StackPanel Margin="0,15,0,15">
                            <TextBlock Text="PackageStore Path" Foreground="White" FontSize="16" FontWeight="Bold" FontFamily="Segoe UI" HorizontalAlignment="Center" Margin="5"/>
                            <Grid Margin="5">
                                <TextBox Name="PackageStorePathTextBox" IsReadOnly="True" Background="Transparent" Width="500" VerticalContentAlignment="Center" mah:TextBoxHelper.Watermark="packagestore.manifest / PackageStoreManifest.json" />
                                <Button Content="Browse" Background="#262626" Width="75" VerticalAlignment="Center" HorizontalAlignment="Right" Click="BrowsePackageStorePath" />
                            </Grid>
                        </StackPanel>

                        <!-- ScriptObjects.bin Path -->
                        <StackPanel Margin="0,15,0,15">
                            <TextBlock Text="ScriptObjects Path" Foreground="White" FontSize="16" FontWeight="Bold" FontFamily="Segoe UI" HorizontalAlignment="Center" Margin="5"/>
                            <Grid Margin="5">
                                <TextBox Name="ScriptObjectsPathTextBox" IsReadOnly="True" Background="Transparent" Width="500" VerticalContentAlignment="Center" mah:TextBoxHelper.Watermark="ScriptObjects.bin" />
                                <Button Content="Browse" Background="#262626" Width="75" VerticalAlignment="Center" HorizontalAlignment="Right" Click="BrowseScriptObjectsPath" />
                            </Grid>
                        </StackPanel>

                        <!-- IoStoreCommands.txt Path -->
                        <StackPanel Margin="0,15,0,15">
                            <TextBlock Text="Commands Path" Foreground="White" FontSize="16" FontWeight="Bold" FontFamily="Segoe UI" HorizontalAlignment="Center" Margin="5"/>
                            <Grid Margin="5">
                                <TextBox Name="IoStoreCommandsPathTextBox" IsReadOnly="True" Background="Transparent" Width="500" VerticalContentAlignment="Center" mah:TextBoxHelper.Watermark="IoStoreCommands.txt / Commands.txt" />
                                <Button Content="Browse" Background="#262626" Width="75" VerticalAlignment="Center" HorizontalAlignment="Right" Click="BrowseIoStoreCommandsPath" />
                            </Grid>
                        </StackPanel>

                        <!-- Crypto Keys Browser -->
                        <StackPanel Margin="0,50,0,0">
                            <Button Content="Edit Crypto.json" Background="#262626" Width="200" Height="40" FontSize="12" FontWeight="Bold" Margin="5" VerticalAlignment="Center" HorizontalAlignment="Center" Click="OpenCryptoKeysFileAsync" />
                        </StackPanel>
                    </StackPanel>

                    <!-- Right Column -->
                    <Grid Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="200" />
                            <RowDefinition Height="200" />
                            <RowDefinition Height="260" />
                        </Grid.RowDefinitions>
                        
                        <!-- Config Selection -->
                        <!--
                        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,0">
                            <Grid HorizontalAlignment="Stretch">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Button Background="#262626" Height="30" Width="30" FontSize="12" FontWeight="Bold" Click="btnIoStoreNewConfig_Click" ToolTip="Add New Config" Grid.Column="0">
                                    <Button.Content>
                                        <iconPacks:PackIconMaterial Kind="PlusBox" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                    </Button.Content>
                                </Button>

                                <Button Background="#262626" Height="30" Width="30" FontSize="12" FontWeight="Bold" Click="btnIoStoreDeleteConfig_Click" ToolTip="Delete Selected Config" Grid.Column="1">
                                    <Button.Content>
                                        <iconPacks:PackIconMaterial Kind="MinusBox" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                    </Button.Content>
                                </Button>

                                <Button Background="#262626" Height="30" Width="30" FontSize="12" FontWeight="Bold" Click="btnIoStoreRenameConfig_Click" ToolTip="Rename Selected Config" Grid.Column="2">
                                    <Button.Content>
                                        <iconPacks:PackIconMaterial Kind="RenameBox" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                    </Button.Content>
                                </Button>

                                <ComboBox Name="ConfigSelectionComboBox" 
                                          Background="Transparent" 
                                          Height="30" 
                                          Width="200" 
                                          VerticalContentAlignment="Center" 
                                          Margin="5,0,0,0" 
                                          Grid.Column="3" 
                                          ItemsSource="{Binding Configurations}" 
                                          SelectedItem="{Binding SelectedConfiguration, Mode=TwoWay}" 
                                          SelectionChanged="ConfigSelectionComboBox_SelectionChanged">
                                </ComboBox>
                            </Grid>
                        </StackPanel>
                        -->

                        <!-- Pack Button -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,30">
                            <Button Content="Pack" Background="#262626" Width="200" Height="40" FontSize="14" FontWeight="Bold" Margin="5" Click="btnIoStorePackage_ClickAsync"/>
                        </StackPanel>

                        <!-- CLI Output -->
                        <StackPanel Grid.Row="2" Grid.ColumnSpan="3" Background="#262626" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,0">
                            <!-- TextBox to display CLI output -->
                            <TextBox x:Name="IoStoreCommandOutputTextBox" 
                                     Background="#202020" 
                                     Foreground="White" 
                                     FontSize="12" 
                                     IsReadOnly="True" 
                                     VerticalScrollBarVisibility="Auto" 
                                     Height="250"
                                     Width="650"
                                     BorderBrush="#7F7F7F" 
                                     BorderThickness="1"
                                     FocusVisualStyle="{x:Null}">
                                <TextBox.Template>
                                    <ControlTemplate TargetType="TextBox">
                                        <Border BorderBrush="{TemplateBinding BorderBrush}" 
                                                BorderThickness="{TemplateBinding BorderThickness}" 
                                                Background="{TemplateBinding Background}">
                                            <ScrollViewer x:Name="PART_ContentHost" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto"/>
                                        </Border>
                                    </ControlTemplate>
                                </TextBox.Template>
                            </TextBox>
                        </StackPanel>
                    </Grid>
                </Grid>
            </mah:Flyout>

            <!-- Aes Keys Flyout -->
            <mah:Flyout x:Name="AesKeysFlyout" 
                        Header="AES Key Settings" 
                        Position="Left"
                        Width="600"
                        Background="#1F1F1F"
                        BorderBrush="{DynamicResource MahApps.Brushes.Accent}"
                        BorderThickness="1"
                        IsOpen="{Binding IsAesKeysFlyoutOpen}">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="250"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="250"/>
                    </Grid.RowDefinitions>

                    <!-- Repak AES Key Input Section -->
                    <StackPanel Grid.Row="0" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="5">
                        <TextBlock Text="Repak AES Key" Foreground="White" FontSize="20" FontWeight="Bold" FontFamily="Segoe UI" HorizontalAlignment="Center" Margin="5"/>
                        <TextBox Name="AesKeyTextBox" Background="Transparent" Width="460" Height="30" Margin="5"/>
                        <Button Content="Save" Background="#262626" FontSize="14" FontWeight="Bold" Width="180" Height="40" Margin="5" Click="SaveRepakConfigAsync"/>
                    </StackPanel>

                    <!-- Empty Row (Filler) -->
                    <StackPanel Grid.Row="1" Visibility="Collapsed"/>

                    <!-- ZenTools AES Key Input Section -->
                    <StackPanel Grid.Row="2" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="5">
                        <TextBlock Text="ZenTools AES Key" Foreground="White" FontSize="20" FontWeight="Bold" FontFamily="Segoe UI" HorizontalAlignment="Center" Margin="5"/>
                        <TextBlock Text="GUID" Foreground="White" FontSize="12" FontWeight="Bold" FontFamily="Segoe UI" HorizontalAlignment="Center" Margin="5"/>
                        <TextBox Name="ZenToolsKeyGuidTextBox" Background="Transparent" Width="460" Height="30" Margin="5"/>
                        <TextBlock Text="HEX" Foreground="White" FontSize="12" FontWeight="Bold" FontFamily="Segoe UI" HorizontalAlignment="Center" Margin="5"/>
                        <TextBox Name="ZenToolsKeyHexTextBox" Background="Transparent" Width="460" Height="30" Margin="5"/>
                        <Button Content="Save" Background="#262626" FontSize="14" FontWeight="Bold" Width="180" Height="40" Margin="5" Click="SaveZenToolsConfigAsync"/>
                    </StackPanel>
                </Grid>
            </mah:Flyout>

            <!-- Repak Settings Flyout -->
            <mah:Flyout x:Name="RepakSettingsFlyout" 
                        Header="Repak Settings" 
                        Position="Left"
                        Width="600"
                        Background="#1F1F1F"
                        BorderBrush="{DynamicResource MahApps.Brushes.Accent}"
                        BorderThickness="1"
                        IsOpen="{Binding IsRepakSettingsFlyoutOpen}">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="250"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="350"/>
                    </Grid.RowDefinitions>

                    <!-- Top -->
                    <StackPanel Grid.Row="0" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="5">
                        <!-- Dropdown for Version Switching -->
                        <TextBlock Text="Pak Version" Foreground="White" FontSize="20" FontWeight="Bold" FontFamily="Segoe UI" HorizontalAlignment="Center" Margin="0,5,0,15"/>
                        <ComboBox x:Name="RepakVersionSwitchDropdown" 
                                  Width="150" Height="40" 
                                  SelectedIndex="0" 
                                  SelectionChanged="ComboBox_RepakVersion" 
                                  FontSize="16" FontWeight="Bold"
                                  VerticalAlignment="Center" HorizontalAlignment="Center" 
                                  Grid.Column="1">
                            <ComboBoxItem Content="V11" FontSize="14" Height="25" />
                            <ComboBoxItem Content="V10" FontSize="14" Height="25" />
                            <ComboBoxItem Content="V9" FontSize="14" Height="25" />
                            <ComboBoxItem Content="V8B" FontSize="14" Height="25" />
                            <ComboBoxItem Content="V8A" FontSize="14" Height="25" />
                            <ComboBoxItem Content="V7" FontSize="14" Height="25" />
                            <ComboBoxItem Content="V6" FontSize="14" Height="25" />
                            <ComboBoxItem Content="V5" FontSize="14" Height="25" />
                            <ComboBoxItem Content="V4" FontSize="14" Height="25" />
                            <ComboBoxItem Content="V3" FontSize="14" Height="25" />
                            <ComboBoxItem Content="V2" FontSize="14" Height="25" />
                            <ComboBoxItem Content="V1" FontSize="14" Height="25" />
                        </ComboBox>
                    </StackPanel>

                    <!-- Middle -->
                    <StackPanel Grid.Row="1" Visibility="Collapsed"/>

                    <!-- Bottom -->
                    <StackPanel Grid.Row="2" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="5">
                        <DataGrid x:Name="RepakDataGrid" 
                                  AutoGenerateColumns="False" 
                                  HeadersVisibility="Column" 
                                  GridLinesVisibility="None"
                                  CanUserSortColumns="False"
                                  RowBackground="#202020"
                                  AlternatingRowBackground="#252525"
                                  Foreground="White" 
                                  Background="#262626"
                                  BorderBrush="#7F7F7F"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  Width="580">

                            <!-- Columns -->
                            <DataGrid.Columns>
                                <!-- UE Version Column -->
                                <DataGridTextColumn Header="UE Version" Binding="{Binding UEVersion}" Width="1*" ElementStyle="{StaticResource CenteredCellStyle}">
                                    <DataGridTextColumn.HeaderStyle>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                                            <Setter Property="VerticalContentAlignment" Value="Center" />
                                            <Setter Property="Height" Value="30" />
                                            <Setter Property="FontSize" Value="14" />
                                            <Setter Property="FontWeight" Value="Bold" />
                                            <Setter Property="Background" Value="#2A2A2A" />
                                            <Setter Property="Foreground" Value="White" />
                                            <Setter Property="BorderBrush" Value="#B9B9B9" />
                                            <Setter Property="BorderThickness" Value="0,0,2,3" />
                                        </Style>
                                    </DataGridTextColumn.HeaderStyle>
                                </DataGridTextColumn>

                                <!-- Version Column -->
                                <DataGridTextColumn Header="Version" Binding="{Binding Version}" Width="0.5*" ElementStyle="{StaticResource CenteredCellStyle}">
                                    <DataGridTextColumn.HeaderStyle>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                                            <Setter Property="VerticalContentAlignment" Value="Center" />
                                            <Setter Property="Height" Value="30" />
                                            <Setter Property="FontSize" Value="14" />
                                            <Setter Property="FontWeight" Value="Bold" />
                                            <Setter Property="Background" Value="#2A2A2A" />
                                            <Setter Property="Foreground" Value="White" />
                                            <Setter Property="BorderBrush" Value="#B9B9B9" />
                                            <Setter Property="BorderThickness" Value="0,0,2,3" />
                                        </Style>
                                    </DataGridTextColumn.HeaderStyle>
                                </DataGridTextColumn>

                                <!-- Version Feature Column -->
                                <DataGridTextColumn Header="Version Feature" Binding="{Binding VersionFeature}" Width="1.5*" ElementStyle="{StaticResource CenteredCellStyle}">
                                    <DataGridTextColumn.HeaderStyle>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                                            <Setter Property="VerticalContentAlignment" Value="Center" />
                                            <Setter Property="Height" Value="30" />
                                            <Setter Property="FontSize" Value="14" />
                                            <Setter Property="FontWeight" Value="Bold" />
                                            <Setter Property="Background" Value="#2A2A2A" />
                                            <Setter Property="Foreground" Value="White" />
                                            <Setter Property="BorderBrush" Value="#B9B9B9" />
                                            <Setter Property="BorderThickness" Value="0,0,2,3" />
                                        </Style>
                                    </DataGridTextColumn.HeaderStyle>
                                </DataGridTextColumn>

                                <!-- Read Column -->
                                <DataGridTemplateColumn Header="Read" Width="0.5*">
                                    <DataGridTemplateColumn.HeaderStyle>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                                            <Setter Property="VerticalContentAlignment" Value="Center" />
                                            <Setter Property="Height" Value="30" />
                                            <Setter Property="FontSize" Value="14" />
                                            <Setter Property="FontWeight" Value="Bold" />
                                            <Setter Property="Background" Value="#2A2A2A" />
                                            <Setter Property="Foreground" Value="White" />
                                            <Setter Property="BorderBrush" Value="#B9B9B9" />
                                            <Setter Property="BorderThickness" Value="0,0,2,3" />
                                        </Style>
                                    </DataGridTemplateColumn.HeaderStyle>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Read}" HorizontalAlignment="Center" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <!-- Write Column -->
                                <DataGridTemplateColumn Header="Write" Width="0.5*">
                                    <DataGridTemplateColumn.HeaderStyle>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                                            <Setter Property="VerticalContentAlignment" Value="Center" />
                                            <Setter Property="Height" Value="30" />
                                            <Setter Property="FontSize" Value="14" />
                                            <Setter Property="FontWeight" Value="Bold" />
                                            <Setter Property="Background" Value="#2A2A2A" />
                                            <Setter Property="Foreground" Value="White" />
                                            <Setter Property="BorderBrush" Value="#B9B9B9" />
                                            <Setter Property="BorderThickness" Value="0,0,0,3" />
                                        </Style>
                                    </DataGridTemplateColumn.HeaderStyle>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Write}" HorizontalAlignment="Center" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Grid>
            </mah:Flyout>
        </mah:FlyoutsControl>
    </mah:MetroWindow.Flyouts>
</mah:MetroWindow>
